{"title":"Portfolio construction for a fixed return investment objective","markdown":{"yaml":{"title":"Portfolio construction for a fixed return investment objective","subtitle":"A comparison of different approaches","author":"Stanley Sayianka","format":{"html":{"grid":{"margin-width":"400px"}}},"reference-location":"margin","citation-location":"margin","date":"2023-05-09","categories":["Investments","Quant-finance"],"image":"target-return.png"},"headingText":"originally:       margin-width: 350px","containsRefs":false,"markdown":"\n\n```{r, echo=F, warning=F, message=F}\nknitr::opts_chunk$set(echo=FALSE)\nknitr::opts_chunk$set(warning=FALSE)\nknitr::opts_chunk$set(message=FALSE)\n\n\nrequire(pacman)\np_load(tufte, dplyr, xts, PerformanceAnalytics, kableExtra, PortfolioAnalytics, ggplot2, stringr, stringi, lubridate, quantmod, tidyquant, gridExtra, purrr, corrplot, highcharter, caret, pracma, knitr, ggpubr)\n\n# loading data\nload(\"rfiles/anchored wfa - 15pc target mean - classic rlm algo.RData\")\n\nnse_sec <- readxl::read_xlsx('data/Complete-List-of-Listed-Companies-on-Nairobi-Securities-Exchange-Jan-2020-Best.xlsx')\n\nscientific_theme <- theme(\n  # Text elements\n  text = element_text(family = \"serif\", color = \"black\"),\n  plot.title = element_text(size = 12, face = \"plain\", hjust = 0.5),\n  axis.title = element_text(size = 12, face = \"plain\"),\n  axis.text = element_text(size = 12),\n  axis.text.x = element_text(angle = 0, hjust = 0.5),\n  axis.text.y = element_text(angle = 0, hjust = 1),\n  legend.title = element_text(size = 12),\n  legend.text = element_text(size = 12),\n  \n  # Plot background and grid\n  panel.background = element_rect(fill = \"white\"),\n  panel.grid = element_blank(),\n  \n  # Axis lines and ticks\n  axis.line = element_line(color = \"black\"),\n  axis.ticks = element_line(color = \"black\"),\n  \n  # Remove the right and top axis lines (bty=\"l\" equivalent)\n  axis.line.y.right = element_blank(),\n  axis.line.x.top = element_blank(),\n  \n  # Legend\n  legend.background = element_rect(fill = \"white\"),\n  legend.key = element_rect(fill = \"white\", color = NA),\n  \n  # Plot margins (approximating mar = c(5, 5, 3, 5))\n  plot.margin = margin(t = 3, r = 5, b = 5, l = 5, unit = \"pt\"),\n  \n  # Expand axes to touch the data (xaxs=\"i\", yaxs=\"i\" equivalent)\n  panel.spacing = unit(0, \"lines\"),\n  plot.title.position = \"plot\"\n)\n```\n\n# Strategy specification\n\nThis report presents a quantitative investment strategy that aims to construct a portfolio that closely tracks a $15\\%$ p.a. return, which acts as the minimum acceptable return for an investors. The strategy uses three different approaches to achieve this objective: minimum tracking error optimization, constrained least squares, target downside deviation, and target factor exposure optimization.\n\nThe strategy considers the top 10 stocks in NSE Kenya by market capitalization, plus a Money Market Fund, as the assets. The strategy is evaluated using anchored walk forward optimization, which is a robust back-testing method that optimizes the portfolio weights on multiple windows of data and tests them on out-of-sample data. \n\nThis report provides a comprehensive analysis of the performance and risk characteristics of the strategy and compares the results of the three approaches.\n\n# Investment objective\n\nThe strategy’s main goal is to offer investors a $k\\%$ MAR^[MAR: Minimum Acceptable Return], which is set to $15\\%$ p.a. in this document, by building a portfolio of equities and cash. The strategy follows various portfolio constraints to achieve this goal.\n\n# Investment constraints\n\nThe strategy has some constraints, such as a maximum allocation of $70\\%$ to any single asset, to avoid over exposure to one asset. The strategy is also a fully invested, long only strategy, meaning that it uses all the capital and does not take short positions. The strategy adjusts its portfolio every three months to meet its objectives.\n\n# Investment universe\n\nThe strategy considers the top 10 stocks in NSE by market capitalization, plus a Money Market Fund, as the assets. This selection ensures the liquidity required for re-balancing.\n\n# Algorithm and models\n\nTargeting a $15\\%$ MAR, could be formulated as an index tracking problem^[An index tracking fund is an investment fund that is administered so that its value changes in line with a given share index. Source: Collins Dictionary], where the index in this case is the $15\\%$ MAR itself. Several approaches to this index tracking problem are considered in this article. The first is a method based on the tracking error, the second method is based on constrained least squares,the third method is based on target downside deviation optimization, and the fourth method is based on the target factor exposure optimization.\n\nThese four approaches have a similar objective which is: tracking the MAR effectively.\n\n## The tracking error approach\n\nOne way to solve the index tracking problem, is to use a minimization of tracking error optimization. The tracking error^[The tracking error is a measure of the risk in an investment portfolio that is due to active portfolio management] indicates how closely a portfolio follows a given index to which it is benchmarked. Tracking error is calculated as the standard deviation of the difference between the portfolio returns and the index returns.^[The index return in this case is simply the $15\\%$ return p.a.]\n\nA low tracking error means that the portfolio is closely aligned with the index, while a high tracking error means that the portfolio deviates significantly from the index.\n\nWe consider the construction of a portfolio based on the following constraints:\n\n- Box Constraint: $0 \\leq w_i \\leq 0.7$ for all $i$, where $w_i$ represents the weight of asset $i$ in the portfolio.\n- Long-Only: $w_i \\geq 0$ for all $i$, ensuring that the portfolio consists of long positions only.\n- Full Investment: $\\sum_{i} w_i = 1$, ensuring that the portfolio is fully invested.\n- Tracking Error: The portfolio aims to minimize the Tracking Error to the Minimum Acceptable Return (MAR) of 15% per annum.\n\nTo formulate this problem mathematically, let $r_i$ be the return of asset $i$, $w_i$ be the weight of asset $i$ in the portfolio, and $m$ represent the returns of the 15% MAR. The objective is to minimize the Tracking Error of the portfolio to the MAR. We can express this as follows:\n\n$$\n\\text{Minimize:} \\quad \\sqrt{\\sum_{i} (w_i \\cdot r_i - m)^2}\n$$\n\n$$\n\\text{Subject to:} \\quad 0 \\leq w_i \\leq 0.7, \\quad \\forall i\n$$\n\n$$\n\\quad w_i \\geq 0, \\quad \\forall i\n$$\n\n$$\n\\quad \\sum_{i} w_i = 1\n$$\n\nSolving this optimization problem will provide the optimal weights $w_i$ for constructing the portfolio that minimizes the Tracking Error to the MAR.\n\n## The constrained least squares approach \n\nThe second way to solve the index tracking problem is to use constrained least squares, which is a method that minimizes the squared difference between the portfolio returns and the index returns, subject to some constraints on the portfolio weights.\n\nIn this least squares formulation, the dependent variables are from our investment universe^[The 10 stocks + MMF], and the independent variable is the Minimum Acceptable Return (MAR) of $15\\%$.\n\nTo formulate this problem mathematically, let $x_j$ be the return of stock $i$, and let $y$ represent the weekly MAR. The objective is to find the optimal regression coefficients, denoted as $\\beta_j$, subject to the following constraints:\n\n- Box Constraint: $0 \\leq \\beta_j \\leq 0.7$ for all $j$, where $\\beta_i$ represents the weight of asset $j$ in the portfolio.\n- Long-Only: $\\beta_j \\geq 0$ for all $j$, ensuring that the portfolio consists of long positions only.\n- Full Investment: $\\sum_{j} \\beta_j = 1$, ensuring that the portfolio is fully invested.\n\nThe optimization problem can be formulated as follows:\n\n$$\n\\text{Minimize:} \\quad \\sum_{j} (y - \\beta_j \\cdot x_j)^2\n$$\n\n$$\n\\text{Subject to:} \\quad 0 \\leq \\beta_j \\leq 0.7, \\quad \\forall j\n$$\n\n$$\n\\quad \\sum_{j} \\beta_j = 1\n$$\n\nBy solving this optimization problem, we can determine the optimal values of $\\beta_i$, which represent the weights of the stocks in the portfolio.\n\n\n## Target downside deviation optimization approach\n\nThe third approach to the index tracking problem is to use downside deviation, which is a measure of the downside risk of a portfolio. Downside deviation is the average of the squared differences between the portfolio returns and the target index returns, only when the portfolio returns are below the target index. \n\nIn this section, we formulate the index tracking problem as a portfolio optimization problem that minimizes the downside deviation between the portfolio returns and the $15\\%$ p.a. index, subject to some constraints on the portfolio weights.\n\nLet's consider a portfolio construction problem with the following constraints:\n\n- Box Constraint: $0 \\leq w_i \\leq 0.7$ for all $i$, where $w_i$ represents the weight of asset $i$ in the portfolio.\n- Long-Only: $w_i \\geq 0$ for all $i$, ensuring that the portfolio consists of long positions only.\n- Full Investment: $\\sum_{i} w_i = 1$, ensuring that the portfolio is fully invested.\n- Downside Deviation Risk: The portfolio aims to minimize the downside deviation from a Minimum Acceptable Return (MAR) of $15\\%$ per annum.\n\nTo formulate this problem mathematically, let $r_i$ be the return of asset $i$ and $w_i$ be the weight of asset $i$ in the portfolio. The objective is to minimize the downside deviation from the MAR. We can express this as follows:\n\n$$\n\\text{Minimize:} \\quad \\sqrt{\\frac{1}{n} \\sum_{i} \\left(\\min(0, r_i - \\text{MAR})\\right)^2}\n$$\n\n$$\n\\text{Subject to:} \\quad 0 \\leq w_i \\leq 0.7, \\quad \\forall i\n$$\n\n$$\n\\quad \\sum_{i} w_i = 1\n$$\n\nHere, $n$ represents the number of assets in the portfolio.\n\nSolving this optimization problem will provide the optimal weights $w_i$ for constructing the portfolio.\n\n## Target factor exposure optimization approach\n\nIn the fourth approach, we formulate the index tracking problem as a portfolio optimization problem that minimizes the factor exposure of the portfolio to the $15\\%$ index, subject to the given constraints on the portfolio weights. We set the target factor exposure to zero, implying a zero slope, hence perfect tracking.^[Since the 15% MAR is simply a constant line of points, then a perfect tracking portfolio would pass through these points, and have an intercept equal to the MAR, and a slope of 0.]\n \nIn this approach, we consider a portfolio construction problem with the following constraints:\n\n- Box Constraint: $0 \\leq w_i \\leq 0.7$ for all $i$, where $w_i$ represents the weight of asset $i$ in the portfolio.\n- Long-Only: $w_i \\geq 0$ for all $i$, ensuring that the portfolio consists of long positions only.\n- Full Investment: $\\sum_{i} w_i = 1$, ensuring that the portfolio is fully invested.\n- Factor Exposure: The portfolio aims to minimize the factor exposure to a Minimum Acceptable Return (MAR) of $15\\%$ per annum, with a target factor exposure of 0.\n\nTo formulate this problem mathematically, let $r_i$ be the return of asset $i$, $w_i$ be the weight of asset $i$ in the portfolio and $y$ be the $15\\%$ index. The objective is to minimize the factor exposure to the MAR. We can express this as follows:\n\n$$\n\\text{Given:} \\quad y = \\beta_o + \\beta_1 \\times (r_i \\cdot w_i)\n$$\n\n$$\n\\text{Minimize:} \\quad |\\beta_1| \\hspace{2 mm} \\text{with target: } \\hspace{2 mm} |\\beta_1| = 0\n$$\n\n$$\n\\text{Subject to:} \\quad 0 \\leq w_i \\leq 0.7, \\quad \\forall i\n$$\n\n$$\n\\quad w_i \\geq 0, \\quad \\forall i\n$$\n\n$$\n\\quad \\sum_{i} w_i = 1\n$$\n\nHere, $n$ represents the number of assets in the portfolio.\n\nSolving this optimization problem will provide the optimal weights $w_i$ for constructing the portfolio.\n\n# Analysis report\n\nThis section shows the results of our strategy analysis for the 13-year historical period^[January 2009 - December 2022] and aims to assess the strategy’s performance and its potential for future investment.\n\n## Data\n\nThe data consists of the weekly returns of top 10 stocks listed in NSE Kenya by market capitalization, plus a Money Market Fund^[Zimele MMF], for the period from January 2009 to December 2022. \n\nThe backtesting method is anchored walk forward optimization, which is a technique that divides the data into multiple windows and optimizes the portfolio weights on each window using the target MAR of 15% as the objective function.\n\n```{r p1}\n#| column: margin\nggplot(data = zimele_mmf, aes(x = as.numeric(Year), y = Rate/100))+\n  geom_line()+ geom_point()+\n  scale_y_continuous(labels = scales::percent_format())+\n  labs(title = 'Historical MMF returns', x = '', y = 'Rate')+\n  theme_classic()\n```\n\nThe optimized weights are then applied to the next window and the performance of the portfolio is measured. We repeat this process until we cover all the data and obtain a series of out-of-sample results.\n\n\n```{r s3}\n#| cache: true\ndf1 <- nse_sec |> filter(Ticker %in% colnames(dd)) |>\n  rbind(\n    tibble(\n      `Company Name` = 'MMF',\n      Ticker = 'MMF',\n      Industry = 'Cash/Cash Equivalents'\n    )\n  ) |> mutate(Ticker = factor(Ticker, levels = colnames(dd)[1:11])) |> arrange(Ticker)\n\nknitr::kable(df1, align = 'l')\n```\n\n\nThe equity growth comparison curves are shown below, assuming a starting capital of 100,000 KES for the period under consideration:\n  \n```{r s4}\n#| cache: true\n#| fig-width: 9\n#| fig-height: 8\nport <- cbind(strat_port, bm_sv_port, bm_fx_port, bm_et_port, dd$TARGET) |>\n  na.omit() |>\n  setNames(c('Constrained LS', 'Target DownsideDeviation', 'Target FactorExposure'\n             , 'Min TrackingError', 'Target Return'))\n# port[1, ] <- 0\n\n# equity charts\neq <- port |> data.cumret(initial_eq = 100000) |>\n  data.frame() |>\n  setNames(colnames(port))\n\n# table\n.tbl_stats <- rbind(\n  table.AnnualizedReturns(port, geometric = T),\n  maxDrawdown(port),\n  round(tail(eq, 1), 2)\n) |>\n  t()\n.tbl_stats[, c(1,2,4)] <- apply(.tbl_stats[, c(1,2,4)], 2, scales::percent)\n.tbl_stats <- t(.tbl_stats) |> data.frame() |>\n  setNames(colnames(port))\nrownames(.tbl_stats) <- c('Annualized Return', 'Annualized Volatility',\n                          'Sharpe Ratio(Rf:0%)', 'Max Drawdown', 'End Equity')\n\n# the graphs\npl.tbl <- ggtexttable(.tbl_stats, theme = ttheme(\"light\")) \npl.tbl <- pl.tbl |>\n  table_cell_bg(row = 2:tab_nrow(pl.tbl), column = 5, fill = \"darkolivegreen1\")\npl.eq <- eq |>\n  mutate(Date = ymd(rownames(eq))) |>\n  ggplot()+\n  geom_line(aes(x = Date, y = `Constrained LS`, col='Constrained LS'))+\n  geom_line(aes(x = Date, y = `Target DownsideDeviation`, col = 'Target DownsideDeviation'))+\n  geom_line(aes(x = Date, y = `Target FactorExposure`, col='Target FactorExposure'))+\n  geom_line(aes(x = Date, y = `Min TrackingError`, col = 'Min TrackingError'))+\n  geom_line(aes(x = Date, y = `Target Return`, col = 'Target Return'))+\n  labs(title = 'Equity Chart',\n       subtitle = 'Initial equity: 100,000 KES',\n       x = '', y = 'Wealth')+\n  theme_pubclean()\n\nggarrange(pl.eq, pl.tbl, nrow = 2, heights = c(4,1))\n```\n\nFrom the above chart,it is evident that the constrained LS approach gave the best risk adjusted performance, while the minimum tracking error approach gave the highest end equity. The target factor exposure approach has a highly volatile equity curve, with a large drawdown making it unattractive. \n\nIt is also clear that post September 2015, the performance of the 4 portfolios as compared to the benchmark declines, although the top 3 strategies maintain a strong linear trend.\n\nA benchmarking comparison for the four approaches is shown below:\n\n```{r s5}\ntb.dd <- table.DownsideRisk(R = port[, -5], scale = 52, Rf = 0, MAR = as.numeric(port[2, 5]))\ntb.dd[6, ] <- table.Arbitrary(R = port[, -5], metrics = c('DownsideFrequency'), \n                              metricsNames = c('DownsideFrequency'),\n                              MAR = port[, 5])\ntb.dd[7:9, ] <- NA\ntb.dd <- rbind(tb.dd, Omega(R = port[, -5], L = port[, 5], method = 'simple')) |>\n  na.omit() |>\n  apply(MARGIN = 2, FUN = abs) |>\n  apply(MARGIN = 2, FUN = round, digits = 4)\nrownames(tb.dd) <- c(\"Semi Deviation\", \"Gain Deviation\", \"Loss Deviation\", \"Downside Deviation (MAR=15%)\", \n                     \"Downside Deviation (Rf=0%)\", \"Downside Frequency\", \"Modified VaR (95%)\", \n                     \"Modified ES (95%)\", \"Omega\")\n\ntb.dd[1:8, ] <- apply(tb.dd[1:8, ], 2, scales::percent)\ncolnames(tb.dd) <- c('CLS', 'TDD', 'TFE','MTE')\nknitr::kable(tb.dd, align = 'l', caption = \"CLS is the constrained least squares, TDD - The target downside deviation, TFE - the target factor exposure, MTE - the minimum tracking error approach\")\n```\n\n\nCharts showing the asset allocation across time as well as the diversification as measured by the HHI statistic are shown below:\n  \n```{r s6}\n#| cache: true\n#| fig-width: 9\n#| fig-height: 7\nggplot(allocation_df) +\n  geom_tile(aes(x = Date, y= Ticker, fill = Allocation))+\n  scale_fill_continuous(type = \"viridis\")+\n  facet_wrap(.~Strategy)+\n  labs(title = 'Asset Allocation', x = '', y = '')+\n  theme_classic(base_line_size = .1/100)\n```\n\n\nThe chart indicates that for the 3 leading strategies, there is a huge allocation of capital to the MMF, than to other assets.\n\nThe constrained LS solution assigned the maximum allocation($70\\%$) to the MMF at all periods, and would distribute the remaining $30\\%$ to the rest.\n                                                            \nThe Target Factor Exposure solution assigned a high allocation to ticker: SBIC, and COOP majority of the times, with the rest having their second highest allocations mostly on ticker: BAT and SCOM.\n                                                            \nA graph of the diversification target based on Herfindahl Hirschman Index is shown below:\n\n                                 \n```{r s7}\n#| fig-height: 6\n#| fig-width: 10\n#| cache: true\nrebal_dt <-\n  train.test[, 2] |> sapply(FUN = first_date) |> unname()\n\nhhi_df <-\n  list(norm_weight_bm_et,\n       norm_weight_bm_fx,\n       norm_weight_bm_sv,\n       norm_weight_cls) |>\n  lapply(\n    FUN = function(x)\n      x[rebal_dt]\n  ) |>\n  lapply(\n    FUN = function(x)\n      apply(x, 1, HHI)\n  ) |>\n  list2DF() |>\n  data.frame() |>\n  mutate(Date = ymd(rebal_dt)) |>\n  setNames(\n    c(\n      'Min TrackingError',\n      'Target FactorExposure',\n      'Target DownsideDeviation',\n      'Constrained LS',\n      'Date'\n    )\n  )\n\nhhi_df |>\n  ggplot()+\n  geom_line(aes(x = Date, y = 1-`Constrained LS`, col='Constrained LS'))+\n  geom_line(aes(x = Date, y = 1-`Target DownsideDeviation`, col = 'Target DownsideDeviation'))+\n  geom_line(aes(x = Date, y = 1-`Target FactorExposure`, col='Target FactorExposure'))+\n  geom_line(aes(x = Date, y = 1-`Min TrackingError`, col = 'Min TrackingError'))+\n  scale_y_continuous(labels = scales::percent_format())+\n  labs(title = 'Diversification scores',\n       subtitle = 'The Diversification score is computed using the Herfindahl Hirschman Index',\n       x = '', y = 'HHI Score')+\n  theme_pubclean()\n```\n\nThe diversification for the target factor exposure is higher than the rest, since it avoids the trap of over-allocation to the MMF, but that certainly does not help its performance. The rest of the strategies have diversification values of about $50\\%$ across the times considered.\n\n# Conclusion\n\nBased on the findings of the four strategies considered for the fixed return investment objective, then: the Minimum Tracking Error approach, or the Constrained Least Squares approach is preferred due to the attractiveness of their risk return properties, as compared to the rest. \n\nIt is also important to note that, past September 2015, the four strategies fail to consistently track the 15% chosen index.\n\n# Further work\n\nExploring enhanced index tracking, which allows for closely replicating the performance of a specific benchmark index, such as the our 15% MAR, while seeking to outperform it by applying various active management techniques.\n\n","srcMarkdownNoYaml":"\n\n```{r, echo=F, warning=F, message=F}\n# originally:       margin-width: 350px\nknitr::opts_chunk$set(echo=FALSE)\nknitr::opts_chunk$set(warning=FALSE)\nknitr::opts_chunk$set(message=FALSE)\n\n\nrequire(pacman)\np_load(tufte, dplyr, xts, PerformanceAnalytics, kableExtra, PortfolioAnalytics, ggplot2, stringr, stringi, lubridate, quantmod, tidyquant, gridExtra, purrr, corrplot, highcharter, caret, pracma, knitr, ggpubr)\n\n# loading data\nload(\"rfiles/anchored wfa - 15pc target mean - classic rlm algo.RData\")\n\nnse_sec <- readxl::read_xlsx('data/Complete-List-of-Listed-Companies-on-Nairobi-Securities-Exchange-Jan-2020-Best.xlsx')\n\nscientific_theme <- theme(\n  # Text elements\n  text = element_text(family = \"serif\", color = \"black\"),\n  plot.title = element_text(size = 12, face = \"plain\", hjust = 0.5),\n  axis.title = element_text(size = 12, face = \"plain\"),\n  axis.text = element_text(size = 12),\n  axis.text.x = element_text(angle = 0, hjust = 0.5),\n  axis.text.y = element_text(angle = 0, hjust = 1),\n  legend.title = element_text(size = 12),\n  legend.text = element_text(size = 12),\n  \n  # Plot background and grid\n  panel.background = element_rect(fill = \"white\"),\n  panel.grid = element_blank(),\n  \n  # Axis lines and ticks\n  axis.line = element_line(color = \"black\"),\n  axis.ticks = element_line(color = \"black\"),\n  \n  # Remove the right and top axis lines (bty=\"l\" equivalent)\n  axis.line.y.right = element_blank(),\n  axis.line.x.top = element_blank(),\n  \n  # Legend\n  legend.background = element_rect(fill = \"white\"),\n  legend.key = element_rect(fill = \"white\", color = NA),\n  \n  # Plot margins (approximating mar = c(5, 5, 3, 5))\n  plot.margin = margin(t = 3, r = 5, b = 5, l = 5, unit = \"pt\"),\n  \n  # Expand axes to touch the data (xaxs=\"i\", yaxs=\"i\" equivalent)\n  panel.spacing = unit(0, \"lines\"),\n  plot.title.position = \"plot\"\n)\n```\n\n# Strategy specification\n\nThis report presents a quantitative investment strategy that aims to construct a portfolio that closely tracks a $15\\%$ p.a. return, which acts as the minimum acceptable return for an investors. The strategy uses three different approaches to achieve this objective: minimum tracking error optimization, constrained least squares, target downside deviation, and target factor exposure optimization.\n\nThe strategy considers the top 10 stocks in NSE Kenya by market capitalization, plus a Money Market Fund, as the assets. The strategy is evaluated using anchored walk forward optimization, which is a robust back-testing method that optimizes the portfolio weights on multiple windows of data and tests them on out-of-sample data. \n\nThis report provides a comprehensive analysis of the performance and risk characteristics of the strategy and compares the results of the three approaches.\n\n# Investment objective\n\nThe strategy’s main goal is to offer investors a $k\\%$ MAR^[MAR: Minimum Acceptable Return], which is set to $15\\%$ p.a. in this document, by building a portfolio of equities and cash. The strategy follows various portfolio constraints to achieve this goal.\n\n# Investment constraints\n\nThe strategy has some constraints, such as a maximum allocation of $70\\%$ to any single asset, to avoid over exposure to one asset. The strategy is also a fully invested, long only strategy, meaning that it uses all the capital and does not take short positions. The strategy adjusts its portfolio every three months to meet its objectives.\n\n# Investment universe\n\nThe strategy considers the top 10 stocks in NSE by market capitalization, plus a Money Market Fund, as the assets. This selection ensures the liquidity required for re-balancing.\n\n# Algorithm and models\n\nTargeting a $15\\%$ MAR, could be formulated as an index tracking problem^[An index tracking fund is an investment fund that is administered so that its value changes in line with a given share index. Source: Collins Dictionary], where the index in this case is the $15\\%$ MAR itself. Several approaches to this index tracking problem are considered in this article. The first is a method based on the tracking error, the second method is based on constrained least squares,the third method is based on target downside deviation optimization, and the fourth method is based on the target factor exposure optimization.\n\nThese four approaches have a similar objective which is: tracking the MAR effectively.\n\n## The tracking error approach\n\nOne way to solve the index tracking problem, is to use a minimization of tracking error optimization. The tracking error^[The tracking error is a measure of the risk in an investment portfolio that is due to active portfolio management] indicates how closely a portfolio follows a given index to which it is benchmarked. Tracking error is calculated as the standard deviation of the difference between the portfolio returns and the index returns.^[The index return in this case is simply the $15\\%$ return p.a.]\n\nA low tracking error means that the portfolio is closely aligned with the index, while a high tracking error means that the portfolio deviates significantly from the index.\n\nWe consider the construction of a portfolio based on the following constraints:\n\n- Box Constraint: $0 \\leq w_i \\leq 0.7$ for all $i$, where $w_i$ represents the weight of asset $i$ in the portfolio.\n- Long-Only: $w_i \\geq 0$ for all $i$, ensuring that the portfolio consists of long positions only.\n- Full Investment: $\\sum_{i} w_i = 1$, ensuring that the portfolio is fully invested.\n- Tracking Error: The portfolio aims to minimize the Tracking Error to the Minimum Acceptable Return (MAR) of 15% per annum.\n\nTo formulate this problem mathematically, let $r_i$ be the return of asset $i$, $w_i$ be the weight of asset $i$ in the portfolio, and $m$ represent the returns of the 15% MAR. The objective is to minimize the Tracking Error of the portfolio to the MAR. We can express this as follows:\n\n$$\n\\text{Minimize:} \\quad \\sqrt{\\sum_{i} (w_i \\cdot r_i - m)^2}\n$$\n\n$$\n\\text{Subject to:} \\quad 0 \\leq w_i \\leq 0.7, \\quad \\forall i\n$$\n\n$$\n\\quad w_i \\geq 0, \\quad \\forall i\n$$\n\n$$\n\\quad \\sum_{i} w_i = 1\n$$\n\nSolving this optimization problem will provide the optimal weights $w_i$ for constructing the portfolio that minimizes the Tracking Error to the MAR.\n\n## The constrained least squares approach \n\nThe second way to solve the index tracking problem is to use constrained least squares, which is a method that minimizes the squared difference between the portfolio returns and the index returns, subject to some constraints on the portfolio weights.\n\nIn this least squares formulation, the dependent variables are from our investment universe^[The 10 stocks + MMF], and the independent variable is the Minimum Acceptable Return (MAR) of $15\\%$.\n\nTo formulate this problem mathematically, let $x_j$ be the return of stock $i$, and let $y$ represent the weekly MAR. The objective is to find the optimal regression coefficients, denoted as $\\beta_j$, subject to the following constraints:\n\n- Box Constraint: $0 \\leq \\beta_j \\leq 0.7$ for all $j$, where $\\beta_i$ represents the weight of asset $j$ in the portfolio.\n- Long-Only: $\\beta_j \\geq 0$ for all $j$, ensuring that the portfolio consists of long positions only.\n- Full Investment: $\\sum_{j} \\beta_j = 1$, ensuring that the portfolio is fully invested.\n\nThe optimization problem can be formulated as follows:\n\n$$\n\\text{Minimize:} \\quad \\sum_{j} (y - \\beta_j \\cdot x_j)^2\n$$\n\n$$\n\\text{Subject to:} \\quad 0 \\leq \\beta_j \\leq 0.7, \\quad \\forall j\n$$\n\n$$\n\\quad \\sum_{j} \\beta_j = 1\n$$\n\nBy solving this optimization problem, we can determine the optimal values of $\\beta_i$, which represent the weights of the stocks in the portfolio.\n\n\n## Target downside deviation optimization approach\n\nThe third approach to the index tracking problem is to use downside deviation, which is a measure of the downside risk of a portfolio. Downside deviation is the average of the squared differences between the portfolio returns and the target index returns, only when the portfolio returns are below the target index. \n\nIn this section, we formulate the index tracking problem as a portfolio optimization problem that minimizes the downside deviation between the portfolio returns and the $15\\%$ p.a. index, subject to some constraints on the portfolio weights.\n\nLet's consider a portfolio construction problem with the following constraints:\n\n- Box Constraint: $0 \\leq w_i \\leq 0.7$ for all $i$, where $w_i$ represents the weight of asset $i$ in the portfolio.\n- Long-Only: $w_i \\geq 0$ for all $i$, ensuring that the portfolio consists of long positions only.\n- Full Investment: $\\sum_{i} w_i = 1$, ensuring that the portfolio is fully invested.\n- Downside Deviation Risk: The portfolio aims to minimize the downside deviation from a Minimum Acceptable Return (MAR) of $15\\%$ per annum.\n\nTo formulate this problem mathematically, let $r_i$ be the return of asset $i$ and $w_i$ be the weight of asset $i$ in the portfolio. The objective is to minimize the downside deviation from the MAR. We can express this as follows:\n\n$$\n\\text{Minimize:} \\quad \\sqrt{\\frac{1}{n} \\sum_{i} \\left(\\min(0, r_i - \\text{MAR})\\right)^2}\n$$\n\n$$\n\\text{Subject to:} \\quad 0 \\leq w_i \\leq 0.7, \\quad \\forall i\n$$\n\n$$\n\\quad \\sum_{i} w_i = 1\n$$\n\nHere, $n$ represents the number of assets in the portfolio.\n\nSolving this optimization problem will provide the optimal weights $w_i$ for constructing the portfolio.\n\n## Target factor exposure optimization approach\n\nIn the fourth approach, we formulate the index tracking problem as a portfolio optimization problem that minimizes the factor exposure of the portfolio to the $15\\%$ index, subject to the given constraints on the portfolio weights. We set the target factor exposure to zero, implying a zero slope, hence perfect tracking.^[Since the 15% MAR is simply a constant line of points, then a perfect tracking portfolio would pass through these points, and have an intercept equal to the MAR, and a slope of 0.]\n \nIn this approach, we consider a portfolio construction problem with the following constraints:\n\n- Box Constraint: $0 \\leq w_i \\leq 0.7$ for all $i$, where $w_i$ represents the weight of asset $i$ in the portfolio.\n- Long-Only: $w_i \\geq 0$ for all $i$, ensuring that the portfolio consists of long positions only.\n- Full Investment: $\\sum_{i} w_i = 1$, ensuring that the portfolio is fully invested.\n- Factor Exposure: The portfolio aims to minimize the factor exposure to a Minimum Acceptable Return (MAR) of $15\\%$ per annum, with a target factor exposure of 0.\n\nTo formulate this problem mathematically, let $r_i$ be the return of asset $i$, $w_i$ be the weight of asset $i$ in the portfolio and $y$ be the $15\\%$ index. The objective is to minimize the factor exposure to the MAR. We can express this as follows:\n\n$$\n\\text{Given:} \\quad y = \\beta_o + \\beta_1 \\times (r_i \\cdot w_i)\n$$\n\n$$\n\\text{Minimize:} \\quad |\\beta_1| \\hspace{2 mm} \\text{with target: } \\hspace{2 mm} |\\beta_1| = 0\n$$\n\n$$\n\\text{Subject to:} \\quad 0 \\leq w_i \\leq 0.7, \\quad \\forall i\n$$\n\n$$\n\\quad w_i \\geq 0, \\quad \\forall i\n$$\n\n$$\n\\quad \\sum_{i} w_i = 1\n$$\n\nHere, $n$ represents the number of assets in the portfolio.\n\nSolving this optimization problem will provide the optimal weights $w_i$ for constructing the portfolio.\n\n# Analysis report\n\nThis section shows the results of our strategy analysis for the 13-year historical period^[January 2009 - December 2022] and aims to assess the strategy’s performance and its potential for future investment.\n\n## Data\n\nThe data consists of the weekly returns of top 10 stocks listed in NSE Kenya by market capitalization, plus a Money Market Fund^[Zimele MMF], for the period from January 2009 to December 2022. \n\nThe backtesting method is anchored walk forward optimization, which is a technique that divides the data into multiple windows and optimizes the portfolio weights on each window using the target MAR of 15% as the objective function.\n\n```{r p1}\n#| column: margin\nggplot(data = zimele_mmf, aes(x = as.numeric(Year), y = Rate/100))+\n  geom_line()+ geom_point()+\n  scale_y_continuous(labels = scales::percent_format())+\n  labs(title = 'Historical MMF returns', x = '', y = 'Rate')+\n  theme_classic()\n```\n\nThe optimized weights are then applied to the next window and the performance of the portfolio is measured. We repeat this process until we cover all the data and obtain a series of out-of-sample results.\n\n\n```{r s3}\n#| cache: true\ndf1 <- nse_sec |> filter(Ticker %in% colnames(dd)) |>\n  rbind(\n    tibble(\n      `Company Name` = 'MMF',\n      Ticker = 'MMF',\n      Industry = 'Cash/Cash Equivalents'\n    )\n  ) |> mutate(Ticker = factor(Ticker, levels = colnames(dd)[1:11])) |> arrange(Ticker)\n\nknitr::kable(df1, align = 'l')\n```\n\n\nThe equity growth comparison curves are shown below, assuming a starting capital of 100,000 KES for the period under consideration:\n  \n```{r s4}\n#| cache: true\n#| fig-width: 9\n#| fig-height: 8\nport <- cbind(strat_port, bm_sv_port, bm_fx_port, bm_et_port, dd$TARGET) |>\n  na.omit() |>\n  setNames(c('Constrained LS', 'Target DownsideDeviation', 'Target FactorExposure'\n             , 'Min TrackingError', 'Target Return'))\n# port[1, ] <- 0\n\n# equity charts\neq <- port |> data.cumret(initial_eq = 100000) |>\n  data.frame() |>\n  setNames(colnames(port))\n\n# table\n.tbl_stats <- rbind(\n  table.AnnualizedReturns(port, geometric = T),\n  maxDrawdown(port),\n  round(tail(eq, 1), 2)\n) |>\n  t()\n.tbl_stats[, c(1,2,4)] <- apply(.tbl_stats[, c(1,2,4)], 2, scales::percent)\n.tbl_stats <- t(.tbl_stats) |> data.frame() |>\n  setNames(colnames(port))\nrownames(.tbl_stats) <- c('Annualized Return', 'Annualized Volatility',\n                          'Sharpe Ratio(Rf:0%)', 'Max Drawdown', 'End Equity')\n\n# the graphs\npl.tbl <- ggtexttable(.tbl_stats, theme = ttheme(\"light\")) \npl.tbl <- pl.tbl |>\n  table_cell_bg(row = 2:tab_nrow(pl.tbl), column = 5, fill = \"darkolivegreen1\")\npl.eq <- eq |>\n  mutate(Date = ymd(rownames(eq))) |>\n  ggplot()+\n  geom_line(aes(x = Date, y = `Constrained LS`, col='Constrained LS'))+\n  geom_line(aes(x = Date, y = `Target DownsideDeviation`, col = 'Target DownsideDeviation'))+\n  geom_line(aes(x = Date, y = `Target FactorExposure`, col='Target FactorExposure'))+\n  geom_line(aes(x = Date, y = `Min TrackingError`, col = 'Min TrackingError'))+\n  geom_line(aes(x = Date, y = `Target Return`, col = 'Target Return'))+\n  labs(title = 'Equity Chart',\n       subtitle = 'Initial equity: 100,000 KES',\n       x = '', y = 'Wealth')+\n  theme_pubclean()\n\nggarrange(pl.eq, pl.tbl, nrow = 2, heights = c(4,1))\n```\n\nFrom the above chart,it is evident that the constrained LS approach gave the best risk adjusted performance, while the minimum tracking error approach gave the highest end equity. The target factor exposure approach has a highly volatile equity curve, with a large drawdown making it unattractive. \n\nIt is also clear that post September 2015, the performance of the 4 portfolios as compared to the benchmark declines, although the top 3 strategies maintain a strong linear trend.\n\nA benchmarking comparison for the four approaches is shown below:\n\n```{r s5}\ntb.dd <- table.DownsideRisk(R = port[, -5], scale = 52, Rf = 0, MAR = as.numeric(port[2, 5]))\ntb.dd[6, ] <- table.Arbitrary(R = port[, -5], metrics = c('DownsideFrequency'), \n                              metricsNames = c('DownsideFrequency'),\n                              MAR = port[, 5])\ntb.dd[7:9, ] <- NA\ntb.dd <- rbind(tb.dd, Omega(R = port[, -5], L = port[, 5], method = 'simple')) |>\n  na.omit() |>\n  apply(MARGIN = 2, FUN = abs) |>\n  apply(MARGIN = 2, FUN = round, digits = 4)\nrownames(tb.dd) <- c(\"Semi Deviation\", \"Gain Deviation\", \"Loss Deviation\", \"Downside Deviation (MAR=15%)\", \n                     \"Downside Deviation (Rf=0%)\", \"Downside Frequency\", \"Modified VaR (95%)\", \n                     \"Modified ES (95%)\", \"Omega\")\n\ntb.dd[1:8, ] <- apply(tb.dd[1:8, ], 2, scales::percent)\ncolnames(tb.dd) <- c('CLS', 'TDD', 'TFE','MTE')\nknitr::kable(tb.dd, align = 'l', caption = \"CLS is the constrained least squares, TDD - The target downside deviation, TFE - the target factor exposure, MTE - the minimum tracking error approach\")\n```\n\n\nCharts showing the asset allocation across time as well as the diversification as measured by the HHI statistic are shown below:\n  \n```{r s6}\n#| cache: true\n#| fig-width: 9\n#| fig-height: 7\nggplot(allocation_df) +\n  geom_tile(aes(x = Date, y= Ticker, fill = Allocation))+\n  scale_fill_continuous(type = \"viridis\")+\n  facet_wrap(.~Strategy)+\n  labs(title = 'Asset Allocation', x = '', y = '')+\n  theme_classic(base_line_size = .1/100)\n```\n\n\nThe chart indicates that for the 3 leading strategies, there is a huge allocation of capital to the MMF, than to other assets.\n\nThe constrained LS solution assigned the maximum allocation($70\\%$) to the MMF at all periods, and would distribute the remaining $30\\%$ to the rest.\n                                                            \nThe Target Factor Exposure solution assigned a high allocation to ticker: SBIC, and COOP majority of the times, with the rest having their second highest allocations mostly on ticker: BAT and SCOM.\n                                                            \nA graph of the diversification target based on Herfindahl Hirschman Index is shown below:\n\n                                 \n```{r s7}\n#| fig-height: 6\n#| fig-width: 10\n#| cache: true\nrebal_dt <-\n  train.test[, 2] |> sapply(FUN = first_date) |> unname()\n\nhhi_df <-\n  list(norm_weight_bm_et,\n       norm_weight_bm_fx,\n       norm_weight_bm_sv,\n       norm_weight_cls) |>\n  lapply(\n    FUN = function(x)\n      x[rebal_dt]\n  ) |>\n  lapply(\n    FUN = function(x)\n      apply(x, 1, HHI)\n  ) |>\n  list2DF() |>\n  data.frame() |>\n  mutate(Date = ymd(rebal_dt)) |>\n  setNames(\n    c(\n      'Min TrackingError',\n      'Target FactorExposure',\n      'Target DownsideDeviation',\n      'Constrained LS',\n      'Date'\n    )\n  )\n\nhhi_df |>\n  ggplot()+\n  geom_line(aes(x = Date, y = 1-`Constrained LS`, col='Constrained LS'))+\n  geom_line(aes(x = Date, y = 1-`Target DownsideDeviation`, col = 'Target DownsideDeviation'))+\n  geom_line(aes(x = Date, y = 1-`Target FactorExposure`, col='Target FactorExposure'))+\n  geom_line(aes(x = Date, y = 1-`Min TrackingError`, col = 'Min TrackingError'))+\n  scale_y_continuous(labels = scales::percent_format())+\n  labs(title = 'Diversification scores',\n       subtitle = 'The Diversification score is computed using the Herfindahl Hirschman Index',\n       x = '', y = 'HHI Score')+\n  theme_pubclean()\n```\n\nThe diversification for the target factor exposure is higher than the rest, since it avoids the trap of over-allocation to the MMF, but that certainly does not help its performance. The rest of the strategies have diversification values of about $50\\%$ across the times considered.\n\n# Conclusion\n\nBased on the findings of the four strategies considered for the fixed return investment objective, then: the Minimum Tracking Error approach, or the Constrained Least Squares approach is preferred due to the attractiveness of their risk return properties, as compared to the rest. \n\nIt is also important to note that, past September 2015, the four strategies fail to consistently track the 15% chosen index.\n\n# Further work\n\nExploring enhanced index tracking, which allows for closely replicating the performance of a specific benchmark index, such as the our 15% MAR, while seeking to outperform it by applying various active management techniques.\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"reference-location":"margin","output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","editor":"visual","theme":"cosmo","title-block-banner":true,"title":"Portfolio construction for a fixed return investment objective","subtitle":"A comparison of different approaches","author":"Stanley Sayianka","citation-location":"margin","date":"2023-05-09","categories":["Investments","Quant-finance"],"image":"target-return.png","grid":{"margin-width":"400px"}},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}