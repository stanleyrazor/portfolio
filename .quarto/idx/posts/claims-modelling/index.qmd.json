{"title":"Multivariate modelling of the frequency and severity of insurance claims","markdown":{"yaml":{"title":"Multivariate modelling of the frequency and severity of insurance claims","author":"Stanley Sayianka & Precious Mumbi","date":"2024-03-22","categories":["code","analysis"],"image":"insurance1.png"},"headingText":"Introduction","containsRefs":false,"markdown":"\n\n\nInsurance companies are financial institutions that mitigates risk by providing protection against potential losses or damages. Policyholders pay regular premiums to an insurance company in exchange for coverage. In the event of a covered incident, they can file claims to receive compensation. \n\nThis article will focus on insurance claims experience data, from a portfolio of insurance claims.\n\nIn trying to understand a portfolio of insurance claims, we are concerned with two variables: the claims frequency, and claims severity.\n\n**Claim frequency:** Number of expected or actual claims which occur in a given time period.\n\n**Claim severity:** This refers to the financial cost of a claim.\n\n------------------------------------------------------------------------\n\nThe data is obtained with permission from a liability insurance company in Kenya, and a glimpse of the data is shown below:\n\n```{r, echo=F, warning=F, message=F}\nlibrary(pacman)\n\np_load(dplyr, ggplot2, tidyverse, stringr, stringi, moments, fitdistrplus, readxl, lubridate, patchwork, gridExtra, ggpubr, plotly, moments, tidyr, stringr, ggcorrplot, brms)\n\n# Loading Data ------------------------------------------------------------\n# setwd('/Users/cema/Documents/GitHub/NCWorkforce/Claims-experience')\nclaimdata <- read_excel(\"data/claims2.xlsx\")\n\nclaimdata <- claimdata |>\n  dplyr::select(!c(\"CLAIM\", \"percentile\")) |>\n  mutate(\n    REV_ACC_DATE = ymd(\"1900-01-01\") + REV_ACC_DATE,\n    min_report_date = ymd(\"1900-01-01\") + min_report_date\n  ) |>\n  setNames(c(\"Class\", \"Reporting date\", \"Claim amount\", \"Settlement date\")) |>\n  filter(`Reporting date` > ymd('2005-01-01') & `Claim amount` > 1e3)\n#head(claimdata)\nknitr::kable(head(claimdata))\n\n```\n\n## Claim frequency\n\nIn total, we have 23,057 claims. The reporting date ranges from January 2005 to 2020 December. The distribution of policy classes and a smoothed time series of monthly aggregated counts for the various policy types is shown below:\n\n```{r, echo=F, warning=F, message=F, fig.width=12}\np1 = ggplot(claimdata) + \n  geom_bar(aes(x = Class), width = .3, col = 'blue3', fill = 'blue3', alpha = .3) +\n  labs(title = 'Policy distributions', y = 'Count') +\n  theme_classic()\n\np2 =claimdata |>\n    mutate(ym = paste0(year(`Reporting date`), '-', month(`Reporting date`)) |> ym()) |>\n    group_by(Class, ym) |>\n    summarise(count = n()) |>\n    \n    ggplot() + \n    geom_point(aes(x = ym, y = count, col = Class)) +\n    geom_line(aes(x = ym, y = count, col = Class), lwd=.3, alpha=.5) +\n    geom_smooth(aes(x = ym, y = count, col = Class), method = 'gam') +\n    labs(title = 'Monthly aggregated claim frequency',\n         x = 'Date', y = 'Monthly counts (#)',\n         col = 'Class: ') + \n    theme_classic() + \n    theme(legend.position = 'top')\n\ngrid.arrange(p1, p2, widths=c(1,2))\n```\n\nThe liability claims take a larger share of the portfolio, followed by property, and accident takes the smallest share of the portfolio. There was a sharp spike in claims frequency during the period mid-2012 in liability claims, and the general trend post 2015 is a declining one in all policy types.\n\n## Claim severity\n\nThe claim severity distribution for the three insurance classes is shown below. Due to the highly skewed nature of the data *(minimum claim: 1030, maximum claim: 21 million)*, a log transformation is appropriate for visualization clarity.\n\n```{r, echo=F, warning=F, message=F, fig.width=12}\np1 = ggdensity(claimdata |> mutate(`Claim amount` = log(`Claim amount`)),\n          x = 'Claim amount', fill = 'Class') + \n  labs(title = 'Distribuition of claim severity',\n       x = 'Log claim amount', y = 'Density', fill = NULL) +\n  theme_classic() +\n  theme(legend.position = 'bottom')\n\np2 =claimdata |>\n    mutate(ym = paste0(year(`Reporting date`), '-', month(`Reporting date`)) |> ym()) |>\n    group_by(Class, ym) |>\n    summarise(total = sum(`Claim amount`) |> log()) |>\n    \n    ggplot() + \n    geom_point(aes(x = ym, y = total, col = Class), alpha=.5) +\n    geom_line(aes(x = ym, y = total, col = Class), lwd=.3, alpha=.5) +\n    geom_smooth(aes(x = ym, y = total, col = Class), method = 'gam') +\n    labs(title = 'Monthly aggregated log-claim severity',\n         x = 'Date', y = 'Monthly total claim severity',\n         col = 'Class: ') + \n    theme_classic() + \n    theme(legend.position = 'bottom')\n\ngrid.arrange(p1, p2, widths=c(1,2))\n\n```\n\nThe accident claims have the lowest average claim amounts, while the liability claims have the highest average amounts. Overall, there is a significant overlap among the claim amounts of the three classes. The data are highly skewed and heavy tailed, with the summary statistics shown below:\n\n```{r, echo=F}\ntemp = claimdata |>\n  select(sev = `Claim amount`, type = Class) |>\n  mutate(logsev = log(sev)) |>group_by(type) |>\n    summarise(across(\n      .cols = everything(),\n      .fns = list(\n        mean = ~ mean(.x, na.rm = TRUE),\n        variance = ~ var(.x, na.rm = TRUE),\n        skewness = ~ skewness(.x, na.rm = TRUE),\n        kurtosis = ~ kurtosis(.x, na.rm = TRUE)\n      ),\n      .names = \"{col}_{fn}\"\n    )) |>\n  pivot_longer(-type) |>\n  mutate(Data = ifelse(str_starts(name, 'sev'), 'Severity', 'Log severity'),\n         Function = str_split(name, '_') |> lapply(FUN = last) |> unlist() |> str_to_sentence(),\n         value = round(value, 0)) |>\n  select(Class = type, Value = value, Data, Function) |>\n  pivot_wider(names_from = Function,\n    values_from = Value)\n\nknitr::kable(temp)\n```\n\nThe liability data has the highest skewness and kurtosis, followed by property and finally accident claims. Property claims have the highest mean and variance among the three classes. The log-transformation has effectively reduced the skewness and kurtosis of the data, making it simpler.\n\n------------------------------------------------------------------------\n\nThe correlation matrix of the aggregated data are shown below:\n\n```{r, echo=F, fig.height=6}\ngdf = claimdata |>\n    mutate(ym = paste0(year(`Reporting date`), '-', month(`Reporting date`)) |> ym()) |>\n    group_by(Class, ym) |>\n    arrange(ym) |>\n    mutate(time = row_number()) |>\n    reframe(count = n(),\n              total = sum(`Claim amount`) |> log())  |>\n    group_by(Class) |>\n    arrange(ym) |>\n    mutate(time = row_number()) |>\n    ungroup()\n\n\ncor_list = gdf |> \n  group_by(Class) |> \n  dplyr::group_split() |>\n  lapply(FUN = \\(x) \nggcorrplot(cor(x[, c('time', 'count', 'total')]), lab = T,            colors = c('red' ,'white', 'blue')) + \n  ggtitle(x |> pull(Class) |> unique()))\n  \n  \ndo.call(grid.arrange, c(cor_list, ncol = 2))\n  \n  \n```\n\nThere is a high correlation between the claim frequency and severity in liability insurance, as compared to accident and property insurance. There is also a higher correlation between the aggregate claim frequency and time in liability insurance as compared to the rest suggesting that claim frequency in liability insurance has been increasing with time.\n\n## Modelling\n\nWe aim to model the aggregated frequency at the monthly level and the aggregated claim severity at the monthly level. Typical analyses often seperate the modelling of frequency from severity, however in this analysis, we aim to use multi-variate modelling to model both simultaneously.\n\nSince the claim frequencies are count data, then an appropriate statistical distribution should have the poperty that: it is a discrete distribution, has positive skewness. Such distributions include count distributions such as the Poisson distribution and the negative binomial distribution.\n\nFor claim severity modelling, the distributions appropriate for analysis are those which: have high skewness, support is the positive real line, have heavy tails. Examples of distributions for such include: Log-normal distribution, Pareto distribution and other heavy tailed distributions such as the Burr distribution.\n\nFor a start, we fit a multivariate model on the data, where the claim frequency is modelled as a poisson random variable, while the log-claim severity is modelled as a normal random variable. The model fitted is an intercept only model.\n","srcMarkdownNoYaml":"\n\n# Introduction\n\nInsurance companies are financial institutions that mitigates risk by providing protection against potential losses or damages. Policyholders pay regular premiums to an insurance company in exchange for coverage. In the event of a covered incident, they can file claims to receive compensation. \n\nThis article will focus on insurance claims experience data, from a portfolio of insurance claims.\n\nIn trying to understand a portfolio of insurance claims, we are concerned with two variables: the claims frequency, and claims severity.\n\n**Claim frequency:** Number of expected or actual claims which occur in a given time period.\n\n**Claim severity:** This refers to the financial cost of a claim.\n\n------------------------------------------------------------------------\n\nThe data is obtained with permission from a liability insurance company in Kenya, and a glimpse of the data is shown below:\n\n```{r, echo=F, warning=F, message=F}\nlibrary(pacman)\n\np_load(dplyr, ggplot2, tidyverse, stringr, stringi, moments, fitdistrplus, readxl, lubridate, patchwork, gridExtra, ggpubr, plotly, moments, tidyr, stringr, ggcorrplot, brms)\n\n# Loading Data ------------------------------------------------------------\n# setwd('/Users/cema/Documents/GitHub/NCWorkforce/Claims-experience')\nclaimdata <- read_excel(\"data/claims2.xlsx\")\n\nclaimdata <- claimdata |>\n  dplyr::select(!c(\"CLAIM\", \"percentile\")) |>\n  mutate(\n    REV_ACC_DATE = ymd(\"1900-01-01\") + REV_ACC_DATE,\n    min_report_date = ymd(\"1900-01-01\") + min_report_date\n  ) |>\n  setNames(c(\"Class\", \"Reporting date\", \"Claim amount\", \"Settlement date\")) |>\n  filter(`Reporting date` > ymd('2005-01-01') & `Claim amount` > 1e3)\n#head(claimdata)\nknitr::kable(head(claimdata))\n\n```\n\n## Claim frequency\n\nIn total, we have 23,057 claims. The reporting date ranges from January 2005 to 2020 December. The distribution of policy classes and a smoothed time series of monthly aggregated counts for the various policy types is shown below:\n\n```{r, echo=F, warning=F, message=F, fig.width=12}\np1 = ggplot(claimdata) + \n  geom_bar(aes(x = Class), width = .3, col = 'blue3', fill = 'blue3', alpha = .3) +\n  labs(title = 'Policy distributions', y = 'Count') +\n  theme_classic()\n\np2 =claimdata |>\n    mutate(ym = paste0(year(`Reporting date`), '-', month(`Reporting date`)) |> ym()) |>\n    group_by(Class, ym) |>\n    summarise(count = n()) |>\n    \n    ggplot() + \n    geom_point(aes(x = ym, y = count, col = Class)) +\n    geom_line(aes(x = ym, y = count, col = Class), lwd=.3, alpha=.5) +\n    geom_smooth(aes(x = ym, y = count, col = Class), method = 'gam') +\n    labs(title = 'Monthly aggregated claim frequency',\n         x = 'Date', y = 'Monthly counts (#)',\n         col = 'Class: ') + \n    theme_classic() + \n    theme(legend.position = 'top')\n\ngrid.arrange(p1, p2, widths=c(1,2))\n```\n\nThe liability claims take a larger share of the portfolio, followed by property, and accident takes the smallest share of the portfolio. There was a sharp spike in claims frequency during the period mid-2012 in liability claims, and the general trend post 2015 is a declining one in all policy types.\n\n## Claim severity\n\nThe claim severity distribution for the three insurance classes is shown below. Due to the highly skewed nature of the data *(minimum claim: 1030, maximum claim: 21 million)*, a log transformation is appropriate for visualization clarity.\n\n```{r, echo=F, warning=F, message=F, fig.width=12}\np1 = ggdensity(claimdata |> mutate(`Claim amount` = log(`Claim amount`)),\n          x = 'Claim amount', fill = 'Class') + \n  labs(title = 'Distribuition of claim severity',\n       x = 'Log claim amount', y = 'Density', fill = NULL) +\n  theme_classic() +\n  theme(legend.position = 'bottom')\n\np2 =claimdata |>\n    mutate(ym = paste0(year(`Reporting date`), '-', month(`Reporting date`)) |> ym()) |>\n    group_by(Class, ym) |>\n    summarise(total = sum(`Claim amount`) |> log()) |>\n    \n    ggplot() + \n    geom_point(aes(x = ym, y = total, col = Class), alpha=.5) +\n    geom_line(aes(x = ym, y = total, col = Class), lwd=.3, alpha=.5) +\n    geom_smooth(aes(x = ym, y = total, col = Class), method = 'gam') +\n    labs(title = 'Monthly aggregated log-claim severity',\n         x = 'Date', y = 'Monthly total claim severity',\n         col = 'Class: ') + \n    theme_classic() + \n    theme(legend.position = 'bottom')\n\ngrid.arrange(p1, p2, widths=c(1,2))\n\n```\n\nThe accident claims have the lowest average claim amounts, while the liability claims have the highest average amounts. Overall, there is a significant overlap among the claim amounts of the three classes. The data are highly skewed and heavy tailed, with the summary statistics shown below:\n\n```{r, echo=F}\ntemp = claimdata |>\n  select(sev = `Claim amount`, type = Class) |>\n  mutate(logsev = log(sev)) |>group_by(type) |>\n    summarise(across(\n      .cols = everything(),\n      .fns = list(\n        mean = ~ mean(.x, na.rm = TRUE),\n        variance = ~ var(.x, na.rm = TRUE),\n        skewness = ~ skewness(.x, na.rm = TRUE),\n        kurtosis = ~ kurtosis(.x, na.rm = TRUE)\n      ),\n      .names = \"{col}_{fn}\"\n    )) |>\n  pivot_longer(-type) |>\n  mutate(Data = ifelse(str_starts(name, 'sev'), 'Severity', 'Log severity'),\n         Function = str_split(name, '_') |> lapply(FUN = last) |> unlist() |> str_to_sentence(),\n         value = round(value, 0)) |>\n  select(Class = type, Value = value, Data, Function) |>\n  pivot_wider(names_from = Function,\n    values_from = Value)\n\nknitr::kable(temp)\n```\n\nThe liability data has the highest skewness and kurtosis, followed by property and finally accident claims. Property claims have the highest mean and variance among the three classes. The log-transformation has effectively reduced the skewness and kurtosis of the data, making it simpler.\n\n------------------------------------------------------------------------\n\nThe correlation matrix of the aggregated data are shown below:\n\n```{r, echo=F, fig.height=6}\ngdf = claimdata |>\n    mutate(ym = paste0(year(`Reporting date`), '-', month(`Reporting date`)) |> ym()) |>\n    group_by(Class, ym) |>\n    arrange(ym) |>\n    mutate(time = row_number()) |>\n    reframe(count = n(),\n              total = sum(`Claim amount`) |> log())  |>\n    group_by(Class) |>\n    arrange(ym) |>\n    mutate(time = row_number()) |>\n    ungroup()\n\n\ncor_list = gdf |> \n  group_by(Class) |> \n  dplyr::group_split() |>\n  lapply(FUN = \\(x) \nggcorrplot(cor(x[, c('time', 'count', 'total')]), lab = T,            colors = c('red' ,'white', 'blue')) + \n  ggtitle(x |> pull(Class) |> unique()))\n  \n  \ndo.call(grid.arrange, c(cor_list, ncol = 2))\n  \n  \n```\n\nThere is a high correlation between the claim frequency and severity in liability insurance, as compared to accident and property insurance. There is also a higher correlation between the aggregate claim frequency and time in liability insurance as compared to the rest suggesting that claim frequency in liability insurance has been increasing with time.\n\n## Modelling\n\nWe aim to model the aggregated frequency at the monthly level and the aggregated claim severity at the monthly level. Typical analyses often seperate the modelling of frequency from severity, however in this analysis, we aim to use multi-variate modelling to model both simultaneously.\n\nSince the claim frequencies are count data, then an appropriate statistical distribution should have the poperty that: it is a discrete distribution, has positive skewness. Such distributions include count distributions such as the Poisson distribution and the negative binomial distribution.\n\nFor claim severity modelling, the distributions appropriate for analysis are those which: have high skewness, support is the positive real line, have heavy tails. Examples of distributions for such include: Log-normal distribution, Pareto distribution and other heavy tailed distributions such as the Burr distribution.\n\nFor a start, we fit a multivariate model on the data, where the claim frequency is modelled as a poisson random variable, while the log-claim severity is modelled as a normal random variable. The model fitted is an intercept only model.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","editor":"visual","theme":"cosmo","title-block-banner":true,"title":"Multivariate modelling of the frequency and severity of insurance claims","author":"Stanley Sayianka & Precious Mumbi","date":"2024-03-22","categories":["code","analysis"],"image":"insurance1.png"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}